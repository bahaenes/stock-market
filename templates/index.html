<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finans Analiz Aracı</title>
    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; margin: 0; background-color: #f8f9fa; color: #212529; }
        .page-container { display: flex; }
        .sidebar { width: 200px; background-color: #e9ecef; padding: 20px; height: 100vh; border-right: 1px solid #dee2e6; }
        .sidebar h2 { margin-top: 0; font-size: 1.1em; color: #495057; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar li { margin-bottom: 8px; }
        .sidebar a { text-decoration: none; color: #007bff; cursor: pointer; font-size: 0.95em; }
        .sidebar a:hover { text-decoration: underline; }
        .main-content { flex-grow: 1; padding: 30px; max-width: calc(100% - 240px); /* Sidebar genişliği + padding */}
        .container { max-width: 900px; margin: auto; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
        .form-group { margin-bottom: 20px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        label { margin-bottom: 0; /* Flexbox hizalama için */ }
        input[type="text"], select { padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 1em; }
        input[type="text"] { flex-grow: 1; min-width: 150px; }
        select { min-width: 120px; }
        button { padding: 10px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 1em; transition: background-color 0.2s ease; }
        button:hover { background-color: #0056b3; }
        .chart { margin-top: 30px; border-top: 1px solid #eee; padding-top: 30px; }
        .indicators { margin-top: 25px; border-top: 1px solid #eee; padding-top: 25px; }
        .indicators h2 { font-size: 1.2em; margin-bottom: 15px; color: #343a40;}
        .indicators ul { list-style: none; padding: 0; columns: 2; gap: 20px; /* Göstergeleri 2 sütunda göster */}
        .indicators li { margin-bottom: 10px; font-size: 0.95em; color: #495057; }
        .error { color: #dc3545; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 10px 15px; border-radius: 4px; margin-bottom: 20px; }
        .summary { margin-top: 25px; padding: 20px; background-color: #f1f3f5; border-radius: 5px; line-height: 1.6; font-size: 0.95em; border: 1px solid #dee2e6; }
        .summary h2 { margin-top: 0; font-size: 1.2em; color: #343a40; margin-bottom: 10px; }
        .summary p { margin-bottom: 0; }
        .disclaimer { font-size: 0.8em; color: #6c757d; margin-top: 15px; }
        .news-section { margin-top: 25px; padding: 20px; background-color: #f1f3f5; border-radius: 5px; line-height: 1.6; font-size: 0.95em; border: 1px solid #dee2e6; }
        .news-section h2 { margin-top: 0; font-size: 1.2em; color: #343a40; margin-bottom: 10px; }
        .news-section ul { list-style: none; padding: 0; columns: 2; gap: 20px; /* Göstergeleri 2 sütunda göster */}
        .news-item { margin-bottom: 10px; font-size: 0.95em; color: #495057; }
        .news-item a { text-decoration: none; color: #007bff; cursor: pointer; }
        .news-item a:hover { text-decoration: underline; }
        .sentiment-positive { color: #28a745; }
        .sentiment-neutral { color: #6c757d; }
        .sentiment-negative { color: #dc3545; }
        .sentiment-label { font-size: 0.8em; color: #6c757d; margin-left: 5px; }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="sidebar">
            <h2>Popüler Hisseler</h2>
            <h3>BIST</h3>
            <ul id="bist-tickers">
                <li><a href="#" data-ticker="GARAN.IS">GARAN.IS</a></li>
                <li><a href="#" data-ticker="THYAO.IS">THYAO.IS</a></li>
                <li><a href="#" data-ticker="EREGL.IS">EREGL.IS</a></li>
                <li><a href="#" data-ticker="TUPRS.IS">TUPRS.IS</a></li>
                <li><a href="#" data-ticker="AKBNK.IS">AKBNK.IS</a></li>
                <li><a href="#" data-ticker="SISE.IS">SISE.IS</a></li>
            </ul>
            <h3>ABD</h3>
            <ul id="us-tickers">
                <li><a href="#" data-ticker="AAPL">AAPL</a></li>
                <li><a href="#" data-ticker="MSFT">MSFT</a></li>
                <li><a href="#" data-ticker="GOOGL">GOOGL</a></li>
                <li><a href="#" data-ticker="AMZN">AMZN</a></li>
                <li><a href="#" data-ticker="NVDA">NVDA</a></li>
                <li><a href="#" data-ticker="TSLA">TSLA</a></li>
            </ul>
        </div>
        <div class="main-content">
            <div class="container">
                <h1>Hisse Senedi Analiz Aracı</h1>
                <form id="analyze-form" action="/analyze" method="post" class="form-group">
                    <label for="ticker">Hisse Kodu:</label>
                    <input type="text" id="ticker" name="ticker" placeholder="Örn: GARAN.IS, AAPL" required>
                    
                    <label for="period">Periyot:</label>
                    <select id="period" name="period">
                        <option value="1mo">1 Ay</option>
                        <option value="3mo">3 Ay</option>
                        <option value="6mo">6 Ay</option>
                        <option value="1y" selected>1 Yıl</option>
                        <option value="2y">2 Yıl</option>
                        <option value="5y">5 Yıl</option>
                        <option value="max">Maksimum</option>
                    </select>
                    
                    <button type="submit">Analiz Et</button>
                </form>

                {% if error %}
                    <div class="error">{{ error }}</div>
                {% endif %}

                <div class="chart" id="chart">
                    {% if chart_html %}
                        {{ chart_html | safe }}
                    {% else %}
                        <p>Analiz etmek için bir hisse senedi kodu girin veya kenar çubuğundan seçin.</p>
                    {% endif %}
                </div>

                {% if indicators or tech_indicators %}
                    <div class="indicators">
                        {% if indicators %}
                            <h2>Temel Göstergeler</h2>
                            <ul>
                                {% for key, value in indicators.items() %}
                                    <li><b>{{ key }}:</b> {{ value }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        {% if tech_indicators %}
                            <h2>Teknik Göstergeler (Son)</h2>
                            <ul>
                                {% for key, value in tech_indicators.items() %}
                                    <li><b>{{ key }}:</b> {{ value }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                {% endif %}

                {% if news_list %}
                    <div class="news-section indicators">
                        <h2>İlgili Haberler (Son 7 Gün)</h2>
                        <ul class="news-list">
                            {% for news in news_list %}
                                <li class="news-item sentiment-{{ news.sentiment_category.lower() }}">
                                    <a href="{{ news.url }}" target="_blank">{{ news.title }}</a> 
                                    <span class="sentiment-label">({{ news.sentiment_category }}: {{ "%.2f"|format(news.sentiment_score) }})</span>
                                </li>
                            {% endfor %}
                        </ul>
                         <p style="font-size: 0.9em; margin-top: 15px; color: #6c757d;">
                            Ortalama Haber Duyarlılığı: {{ "%.2f"|format(average_sentiment) }}
                        </p>
                    </div>
                {% endif %}

                {% if summary %}
                    <div class="summary">
                        <h2>Özet ve Yorum</h2>
                        <p>{{ summary | replace("\n", "<br>") | safe }}</p> {# Yorumdaki yeni satırları <br> ile değiştir #}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        // Kenar çubuğundaki ticker linklerine tıklama olayını dinle
        document.querySelectorAll('.sidebar a[data-ticker]').forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // Linkin varsayılan davranışını engelle
                const tickerValue = this.getAttribute('data-ticker');
                const tickerInput = document.getElementById('ticker');
                const analyzeForm = document.getElementById('analyze-form');
                
                tickerInput.value = tickerValue; // Formdaki input alanını doldur
                analyzeForm.submit(); // Formu gönder
            });
        });
    </script>
</body>
</html> 